CREATE TABLE PHOTO
(
    ID    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME  VARCHAR(50),
    IMAGE BYTEA,
    DESCRIPTION TEXT,
    UPLOAD_TIMESTAMP TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_PHOTO PRIMARY KEY (ID)
);

CREATE TABLE PHOTO_TAG
(
    PHOTO_ID BIGINT NOT NULL,
    TAG_ID   BIGINT NOT NULL,
    CONSTRAINT PK_PHOTO_TAG PRIMARY KEY (PHOTO_ID, TAG_ID)
);

CREATE TABLE TAG
(
    ID   BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME VARCHAR(20)                             NOT NULL,
    CONSTRAINT PK_TAG PRIMARY KEY (ID)
);

ALTER TABLE TAG
    ADD CONSTRAINT UC_TAG_NAME UNIQUE (NAME);

ALTER TABLE PHOTO_TAG
    ADD CONSTRAINT FK_PHOTO_TAG_ON_PHOTO FOREIGN KEY (PHOTO_ID) REFERENCES PHOTO (ID);

ALTER TABLE PHOTO_TAG
    ADD CONSTRAINT FK_PHOTO_TAG_ON_TAG FOREIGN KEY (TAG_ID) REFERENCES TAG (ID);

CREATE INDEX IDX_RELATION_PHOTO_ID
    ON PHOTO_TAG (PHOTO_ID);

CREATE INDEX IDX_RELATION_TAG_ID
    ON PHOTO_TAG (TAG_ID);